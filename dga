#!/system/bin/sh



LOG_FILE="/storage/emulated/0/aio/dga.log"
DBG_LOG_FILE="/storage/emulated/0/aio/dga_dbg.log"

rm -f "$LOG_FILE" "$DBG_LOG_FILE"

: > "$LOG_FILE"
: > "$DBG_LOG_FILE"

LOG() {
    echo "$1" >> "$LOG_FILE"
}

LOG_D() {
    echo "[$(date +%T)]: $1" >> "$LOG_FILE"
}

sync

LOG_D "- Searching and disabling telemetry services of your apps..."

PACKAGES=$(pm list packages | cut -f 2 -d ":")
EXCEPTION_SERVICES=(
"com.whatsapp.crash.upload.ExceptionsUploadService"
)

keywords=(
"FirebaseInstanceIdService"
"adactivity"
"analytics"
"applog"
"crash"
"diagnostic"
"logcat"
"logger"
"logging"
"logservice"
"measurement"
"metrics"
"report"
"stats"
"trace"
"tracing"
"track"
)

for keyword in "${keywords[@]}"; do
    for package in $PACKAGES; do
        components=$(dumpsys package "$package" | grep -Ei "Service|Receiver" | grep -i "$keyword")
        for component in $components; do
            component_name=$(echo "$component" | cut -d ' ' -f 2)
            for exception_service in "${EXCEPTION_SERVICES[@]}"; do
                if [ "$component_name" != "$exception_service" ]; then
                    if pm disable "$package/$component_name" > /dev/null 2>&1; then
                        echo "DISABLED: $package/$component_name" >> "$DBG_LOG_FILE"
                        ((COUNTER++))
                    fi
                fi
            done
        done
    done
done

LOG " "
LOG_D "- Finished."

LOG " "
LOG "～～～～～～～～～～～～～～～～～～～～～～～～～"
LOG_D "DisableGoogleAnalytics is successfully applied."
LOG_D "Total disabled services: $COUNTER."
LOG "～～～～～～～～～～～～～～～～～～～～～～～～～"
